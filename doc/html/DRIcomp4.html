<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<TITLE>Linux Kernel Preparation </TITLE>
</HEAD>
<BODY BGCOLOR="#efefef" TEXT="black" LINK="blue" VLINK="#551A8B" ALINK="red">

<A HREF="DRIcomp.html"><EM>DRI Compilation Guide </EM></A>
 <b>:</b> <EM>Linux Kernel Preparation </EM><BR>
<b>Previous:</b> <A HREF="DRIcomp3.html"><EM>Prerequisites </EM></A><BR>
<b>Next:</b> <A HREF="DRIcomp5.html"><EM>CPU Architectures </EM></A>


<HR NOSHADE>
  <H2><A NAME="6"></A>4. Linux Kernel Preparation </H2>

<p>Only the Linux 2.4.x kernels are currently supported by the DRI
hardware drivers.  2.5.x kernels may work, but aren't tested.</p>
<p>Most of the DRI drivers require AGP support and using Intel
Pentium III SSE optimizations also requires an up-to-date Linux
kernel.  Configuring your kernel correctly is very important, as
features such as SSE optimizations will be disabled if your
kernel does not support them.  Thus, if you have a Pentium III
processor, you must configure your kernel for the Pentium III
processor family.</p>
<p>Building a new Linux kernel can be difficult for beginners but
there are resources on the Internet to help.
This document assumes experience with configuring, building and
installing Linux kernels.</p>
<p>Linux kernels can be downloaded from
<A href="http://www.kernel.org/pub/linux/kernel/">www.kernel.org</A></p>
<p>Here are the basic steps for kernel setup.
<ul>
<li>Download the needed kernel and put it in /usr/src.
Create a directory for the source and unpack it.
For example:
<pre>
          cd /usr/src
          rm -f linux
          mkdir linux-2.4.x
          ln -s linux-2.4.x linux
          bzcat linux-2.4.x.tar.bz2 | tar xf -
          
</pre>

It is critical that /usr/src/linux point to your new kernel
sources, otherwise the kernel headers <b>will not</b> be
used when building the DRI.  This will almost certainly cause
compilation problems.</li>
<li>Read /usr/src/linux/Documentation/Changes.
This file lists the minimum requirements for all software
packages required to build the kernel.  You must upgrade at
least gcc, make, binutils and modutils to at least the
versions specified in this file.  The other packages may not
be needed.  If you are upgrading from Linux 2.2.x you must
upgrade your modutils package for Linux 2.4.x.</li>
<li>Configure your kernel.
You might, for example, use <code>make menuconfig</code> and do the
following:

<ul>
<li>Go to <em>Code maturity level options</em></li>
<li>Enable <em>Prompt for development and/or incomplete
code/drivers</em></li>
<li>hit ESC to return to the top-level menu</li>
<li>Go to <em>Processor type and features</em></li>
<li>Select your processor type from <em>Processor Family</em></li>
<li>hit ESC to return to the top-level menu</li>
<li>Go to <em>Character devices</em></li>
<li>Disable <em>Direct Rendering Manager (XFree86 DRI support)</em>
since we'll use the DRI code from the XFree86/DRI tree and will
compile it there.</li>
<li>Go to <em>/dev/agpgart (AGP Support) (EXPERIMENTAL) (NEW)</em></li>
<li>Hit SPACE twice to build AGP support into the kernel</li>
<li>Enable all chipsets' support for AGP</li>
<li>It's recommended that you turn on MTRRs under
<em>Processor type and Features</em>, but not required.</li>
</ul>
</li>
<li>Configure the rest of the kernel as required for your system
(i.e. Ethernet, SCSI, etc)</li>
<li>Exit, saving your kernel configuration.</li>
<li>Edit your /etc/lilo.conf file.
Make sure you have an image entry as follows (or similar):
<pre>
            image=/boot/vmlinuz
                  label=linux.2.4.x
                  read-only
                  root=/dev/hda1
            
</pre>

The important part is that you have /boot/vmlinuz without a
trailing version number.
If this is the first entry in your /etc/lilo.conf AND you
haven't set a default, then this will be your default kernel.</li>
<li>Compile the new kernel.
<pre>
          cd /usr/src/linux-2.4.x
          make dep
          make bzImage
          make modules
          make modules_install
          make install
          
</pre>

Note that last make command will automatically run lilo for you.</li>
<li>Now reboot to use the new kernel.</li>
</ul>
</p>


 <HR NOSHADE>
<A HREF="DRIcomp.html"><EM>DRI Compilation Guide </EM></A>
 <b>:</b> <EM>Linux Kernel Preparation </EM><BR>
<b>Previous:</b> <A HREF="DRIcomp3.html"><EM>Prerequisites </EM></A><BR>
<b>Next:</b> <A HREF="DRIcomp5.html"><EM>CPU Architectures </EM></A>



</BODY>
</HTML>
<!-- text below generated by server. PLEASE REMOVE --><!-- Counter/Statistics data collection code --><script language="JavaScript" src="http://l.yimg.com/d/lib/smb/js/hosting/cp/js_source/whv2_001.js"></script><script language="javascript">geovisit();</script><noscript><img src="http://visit.webhosting.yahoo.com/visit.gif?us1481728786" alt="setstats" border="0" width="1" height="1"></noscript><script type="text/javascript">(function (d, w) {var x = d.getElementsByTagName('SCRIPT')[0];var f = function () {var s = d.createElement('SCRIPT');s.type = 'text/javascript';s.async = true;s.src = "//np.lexity.com/embed/YW/b1fe8415ea3afdda4a8ad34ee7cf1614?id=41958ae7bc0f";x.parentNode.insertBefore(s, x);};w.attachEvent ? w.attachEvent('onload',f) :w.addEventListener('load',f,false);}(document, window));</script>