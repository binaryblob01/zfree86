%!PS-Adobe-3.0
%%Creator: groff version 1.19.2
%%CreationDate: Mon Dec 29 01:16:46 2008
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%+ font Courier
%%DocumentSuppliedResources: procset grops 1.19 2
%%Pages: 6
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.19 2
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/MF{
findfont
[5 2 roll
0 3 1 roll
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
/DA{
newpath arcn stroke
}bind def
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
/DL{
SN
moveto
SN
lineto stroke
}bind def
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
/Fr{
setrgbcolor fill
}bind def
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
/Fg{
setgray fill
}bind def
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
/setpagedevice{}def
}bind def
/PEND{
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%EndProlog
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
%%IncludeResource: font Courier
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Courier@0 ENC0/Courier RE/Times-Roman@0 ENC0/Times-Roman RE
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 14/Times-Bold@0 SF(MIT)140.216 135 Q(-SHM\212The MIT Shar)-1.288 E
(ed Memory Extension)-.252 E/F1 12/Times-Bold@0 SF(Ho)182.406 165 Q 3
(wt)-.12 G(he shar)-3 E(ed memory extension w)-.216 E(orks)-.12 E/F2 10
/Times-Italic@0 SF -.25(Jo)254.375 201 S(nathan Corbet).25 E/F3 10
/Times-Roman@0 SF(Atmospheric T)219.035 219 Q(echnology Di)-.7 E(vision)
-.25 E(National Center for Atmospheric Research)202.465 231 Q
(corbet@ncar)244.52 243 Q(.ucar)-.55 E(.edu)-.55 E -.15(Fo)213.37 267 S
(rmatted and edited for release 5 by).15 E F2 -.35(Ke)259.835 291 S
(ith P).35 E(ac)-.8 E(kar)-.2 E(d)-.37 E F3(MIT X Consortium)249.11 309
Q/F4 9/Times-Italic@0 SF(ABSTRA)266.881 441 Q(CT)-.27 E/F5 9
/Times-Roman@0 SF(This document brie\215y describes ho)133 465 Q 2.25
(wt)-.225 G 2.25(ou)-2.25 G(se the MIT)-2.25 E(-SHM shared memory e)
-.828 E 2.25(xtension. I)-.135 F(ha)2.25 E -.135(ve)-.18 G(tried to mak)
108 477 Q 2.25(ei)-.09 G 2.25(ta)-2.25 G(ccurate, b)-2.25 E(ut it w)-.18
E(ould not surprise me if some errors remained.)-.09 E(If you \214nd an)
4.5 E(ything)-.135 E(wrong, do let me kno)108 489 Q 2.25(wa)-.225 G
(nd I will incorporate the corrections.)-2.25 E(Meanwhile, please tak)
4.5 E 2.25(et)-.09 G(his docu-)-2.25 E(ment `)108 501 Q(`as is')-.666 E
('\212an impro)-.666 E -.135(ve)-.135 G(ment o).135 E -.135(ve)-.135 G
2.25(rw).135 G(hat w)-2.25 E(as there before, b)-.09 E
(ut certainly not the de\214niti)-.18 E .27 -.135(ve w)-.225 H(ord.).045
E(Cop)228.37 534.6 Q(yright \251 1991 X Consortium)-.09 E
(Permission is hereby granted, free of char)72 580.2 Q(ge, to an)-.162 E
2.25(yp)-.135 G(erson obtaining a cop)-2.25 E 2.25(yo)-.09 G 2.25(ft)
-2.25 G(his softw)-2.25 E(are and associated documenta-)-.09 E
(tion \214les \(the `)72 592.2 Q(`Softw)-.666 E(are')-.09 E
('\), to deal in the Softw)-.666 E(are without restriction, including w\
ithout limitation the rights to use,)-.09 E(cop)72 604.2 Q 1.17 -.585
(y, m)-.09 H(odify).585 E 2.25(,m)-.585 G(er)-2.25 E
(ge, publish, distrib)-.162 E
(ute, sublicense, and/or sell copies of the Softw)-.18 E
(are, and to permit persons to whom)-.09 E(the Softw)72 616.2 Q
(are is furnished to do so, subject to the follo)-.09 E
(wing conditions:)-.225 E(The abo)72 631.8 Q .27 -.135(ve c)-.135 H(op)
.135 E(yright notice and this permission notice shall be included in al\
l copies or substantial portions of the Soft-)-.09 E -.09(wa)72 643.8 S
(re.).09 E(THE SOFTW)72 659.4 Q(ARE IS PR)-1.08 E -.45(OV)-.36 G(IDED `)
.45 E -.72(`A)-.666 G 2.25(SI).72 G(S')-2.25 E(', WITHOUT W)-.666 E
(ARRANTY OF ANY KIND, EXPRESS OR IMPLIED,)-1.08 E(INCLUDING B)72 671.4 Q
(UT NO)-.09 E 2.25(TL)-.36 G(IMITED T)-2.25 E 2.25(OT)-.162 G(HE W)-2.25
E(ARRANTIES OF MERCHANT)-1.08 E(ABILITY)-.837 E 2.25(,F)-1.161 G
(ITNESS FOR A P)-2.25 E(AR)-.828 E(TIC-)-.54 E
(ULAR PURPOSE AND NONINFRINGEMENT)72 683.4 Q 4.5(.I)-.666 G 2.25(NN)-4.5
G 2.25(OE)-2.25 G(VENT SHALL THE X CONSOR)-2.25 E(TIUM BE LIABLE FOR)
-.54 E(ANY CLAIM, D)72 695.4 Q(AMA)-.36 E(GES OR O)-.36 E
(THER LIABILITY)-.36 E 2.25(,W)-1.161 G(HETHER IN AN A)-2.25 E
(CTION OF CONTRA)-.36 E(CT)-.36 E 2.25(,T)-.666 G(OR)-2.412 E 2.25(TO)
-.54 G 2.25(RO)-2.25 G(TH-)-2.61 E(ER)72 707.4 Q(WISE, ARISING FR)-.495
E(OM, OUT OF OR IN CONNECTION WITH THE SOFTW)-.36 E(ARE OR THE USE OR O)
-1.08 E(THER)-.36 E(DEALINGS IN THE SOFTW)72 719.4 Q(ARE.)-1.08 E 0 Cg
EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Times-Roman@0 SF(Except as contained in this notice, the name of \
the X Consortium shall not be used in adv)72 84 Q
(ertising or otherwise to pro-)-.135 E
(mote the sale, use or other dealings in this Softw)72 96 Q
(are without prior written authorization from the X Consortium.)-.09 E 0
Cg EP
%%Page: 1 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Bold@0 SF 2.5(1. REQ)72 84 R(UIREMENTS)-.1 E/F1 10
/Times-Roman@0 SF(The shared memory e)72 99.6 Q(xtension is pro)-.15 E
(vided only by some X serv)-.15 E 2.5(ers. T)-.15 F 2.5<6f8c>-.8 G
(nd out if your serv)-2.5 E(er supports the)-.15 E -.15(ex)72 111.6 S
(tension, use xdp).15 E 2.5(yinfo\(1\). In)-.1 F(particular)2.5 E 2.5
(,t)-.4 G 2.5(ob)-2.5 G 2.5(ea)-2.5 G(ble to use this e)-2.5 E
(xtension, your system must pro)-.15 E(vide the)-.15 E
(SYSV shared memory primiti)72 123.6 Q -.15(ve)-.25 G 2.5(s. There).15 F
(is not an mmap-based v)2.5 E(ersion of this e)-.15 E 2.5(xtension. T)
-.15 F 2.5(ou)-.8 G(se shared)-2.5 E(memory on Sun systems, you must ha)
72 135.6 Q .3 -.15(ve b)-.2 H(uilt your k)-.05 E
(ernel with SYSV shared memory enabled -- which is)-.1 E(not the def)72
147.6 Q(ault con\214guration.)-.1 E(Additionally)5 E 2.5(,t)-.65 G
(he shared memeory maximum size will need to be increased)-2.5 E
(on both Sun and Digital systems; the def)72 159.6 Q(aults are f)-.1 E
(ar too small for an)-.1 E 2.5(yu)-.15 G(seful w)-2.5 E(ork.)-.1 E F0
2.5(2. WHA)72 183.6 R 2.5(TI)-.95 G 2.5(SP)-2.5 G -.3(RO)-2.5 G(VIDED)
-.2 E F1(The basic capability pro)72 199.2 Q
(vided is that of shared memory XImages.)-.15 E(This is essentially a v)
5 E(ersion of the xim-)-.15 E(age interf)72 211.2 Q
(ace where the actual image data is stored in a shared memory se)-.1 E
(gment, and thus need not be)-.15 E(mo)72 223.2 Q -.15(ve)-.15 G 2.5(dt)
.15 G(hrough the Xlib interprocess communication channel.)-2.5 E -.15
(Fo)5 G 2.5(rl).15 G(ar)-2.5 E(ge images, use of this f)-.18 E
(acility can)-.1 E(result in some real performance increases.)72 235.2 Q
(Additionally)72 250.8 Q 2.5(,s)-.65 G(ome implementations pro)-2.5 E
(vided shared memory pixmaps.)-.15 E(These are 2 dimensional arrays of)5
E(pix)72 262.8 Q(els in a format speci\214ed by the X serv)-.15 E(er)
-.15 E 2.5(,w)-.4 G
(here the image data is stored in the shared memory se)-2.5 E(gment.)
-.15 E(Through use of shared memory pixmaps, it is possible to change t\
he contents of these pixmaps without)72 274.8 Q(using an)72 286.8 Q 2.5
(yX)-.15 G(lib routines at all.)-2.5 E
(Shared memory pixmaps can only be supported when the X serv)5 E
(er can use)-.15 E(re)72 298.8 Q(gular virtual memory for pixmap data; \
if the pixmaps are stored in some magic graphics hardw)-.15 E(are, your)
-.1 E(application will not be able to share them with the serv)72 310.8
Q(er)-.15 E 5(.X)-.55 G(dp)-5 E(yinfo\(1\) doesn')-.1 E 2.5(tp)-.18 G
(rint this particular nugget)-2.5 E(of information.)72 322.8 Q F0 2.5
(3. HO)72 346.8 R 2.5(WT)-.5 G 2.5(OU)-2.68 G(SE THE SHARED MEMOR)-2.5 E
2.5(YE)-.35 G(XTENSION)-2.5 E F1(Code which uses the shared memory e)72
362.4 Q(xtension must include a number of header \214les:)-.15 E/F2 10
/Courier@0 SF 6(#i)97 378 S(nclude <X11/Xlib.h>)-6 E(/* of course */)43
E 6(#i)97 390 S(nclude <sys/ipc.h>)-6 E 6(#i)97 402 S
(nclude <sys/shm.h>)-6 E 6(#i)97 414 S(nclude <X11/extensions/XShm.h>)-6
E F1(Of course, if the system you are b)72 429.6 Q
(uilding on does not support shared memory)-.2 E 2.5(,t)-.65 G
(he \214le XShm.h may not be)-2.5 E 2.5(present. Y)72 441.6 R(ou may w)
-1.1 E(ant to mak)-.1 E 2.5(el)-.1 G(iberal use of #ifdefs.)-2.5 E(An)72
457.2 Q 2.5(yc)-.15 G(ode which uses the shared memory e)-2.5 E
(xtension should \214rst check to see that the serv)-.15 E(er pro)-.15 E
(vides the)-.15 E -.15(ex)72 469.2 S 2.5(tension. Y).15 F(ou could al)
-1.1 E -.1(wa)-.1 G(ys be running o).1 E -.15(ve)-.15 G 2.5(rt).15 G
(he net, or in some other en)-2.5 E(vironment where the e)-.4 E
(xtension)-.15 E(will not w)72 481.2 Q 2.5(ork. T)-.1 F 2.5(op)-.8 G
(erform this check, call either)-2.5 E F2
(Status XShmQueryExtension \(display\))97 496.8 Q(Display *display)145
508.8 Q F1(or)72 524.4 Q F2
(Status XShmQueryVersion \(display, major, minor, pixmaps\))97 540 Q
(Display *display;)145 552 Q(int *major, *minor;)145 564 Q
(Bool *pixmaps)145 576 Q F1(Where `)72 591.6 Q(`display')-.74 E 2.5('i)
-.74 G(s, of course, the display on which you are running.)-2.5 E
(If the shared memory e)5 E(xtension may)-.15 E(be used, the return v)72
603.6 Q(alue from either function will be T)-.25 E
(rue; otherwise your program should operate using)-.35 E(con)72 615.6 Q
-.15(ve)-.4 G(ntional Xlib calls.).15 E(When the e)5 E(xtension is a)
-.15 E -.25(va)-.2 G(ilable,).25 E F2(XShmQueryVersion)2.5 E F1
(also returns `)2.5 E(`major')-.74 E 2.5('a)-.74 G(nd)-2.5 E -.74(``)72
627.6 S(minor').74 E 2.5('w)-.74 G(hich are the v)-2.5 E
(ersion numbers of the e)-.15 E(xtension implementation, and `)-.15 E
(`pixmaps')-.74 E 2.5('w)-.74 G(hich is T)-2.5 E(rue if)-.35 E(f)-.25 E
(shared memory pixmaps are supported.)72 639.6 Q F0 2.5(4. USE)72 663.6
R(OF SHARED MEMOR)2.5 E 2.5(YX)-.35 G(IMA)-2.5 E(GES)-.55 E F1
(The basic sequence of operations for shared memory XImages is as follo)
72 679.2 Q(ws:)-.25 E 2.5(1\255C)108 694.8 S
(reate the shared memory XImage structure)-2.5 E 2.5(2\255C)108 706.8 S
(reate a shared memory se)-2.5 E(gment to store the image data)-.15 E
2.5(3\255I)108 718.8 S(nform the serv)-2.5 E
(er about the shared memory se)-.15 E(gment)-.15 E 2.5(4\255U)108 730.8
S(se the shared memory XImage, much lik)-2.5 E 2.5(ean)-.1 G(ormal one.)
-2.5 E F0(1)285.5 768 Q 0 Cg EP
%%Page: 2 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(MIT Shared Memory Extension)223.98 48 Q 1.6 -.8
(To c)72 84 T(reate a shared memory XImage, use:).8 E/F1 10/Courier@0 SF
(XImage *XShmCreateImage \(display, visual, depth, format, data,)97 99.6
Q(shminfo, width, height\))247 111.6 Q(Display *display;)145 123.6 Q
(Visual *visual;)145 135.6 Q(unsigned int depth, width, height;)145
147.6 Q(int format;)145 159.6 Q(char *data;)145 171.6 Q
(XShmSegmentInfo *shminfo;)145 183.6 Q F0(Most of the ar)72 199.2 Q(gum\
ents are the same as for XCreateImage; I will not go through them here.)
-.18 E(Note, ho)5 E(we)-.25 E -.15(ve)-.25 G -.4(r,).15 G
(that there are no `)72 211.2 Q(`of)-.74 E(fset')-.25 E(', `)-.74 E
(`bitmap_pad')-.74 E(', or `)-.74 E(`bytes_per_line')-.74 E 2.5('a)-.74
G -.18(rg)-2.5 G 2.5(uments. These).18 F(quantities will be de\214ned)
2.5 E(by the serv)72 223.2 Q
(er itself, and your code needs to abide by them.)-.15 E(Unless you ha)5
E .3 -.15(ve a)-.2 H(lready allocated the shared).15 E(memory se)72
235.2 Q(gment \(see belo)-.15 E(w\), you should pass in NULL for the `)
-.25 E(`data')-.74 E 2.5('p)-.74 G(ointer)-2.5 E(.)-.55 E
(There is one additional ar)72 250.8 Q(gument: `)-.18 E(`shminfo')-.74 E
(', which is a pointer to a structure of type XShmSe)-.74 E(gmentInfo.)
-.15 E -1.1(Yo)72 262.8 S 2.5(um)1.1 G
(ust allocate one of these structures such that it will ha)-2.5 E .3
-.15(ve a l)-.2 H(ifetime at least as long as that of the).15 E
(shared memory XImage.)72 274.8 Q(There is no need to initialize this s\
tructure before the call to XShmCreateImage.)5 E(The return v)72 290.4 Q
(alue, if all goes well, will be an XImage structure, which you can use\
 for the subsequent steps.)-.25 E(The ne)72 306 Q
(xt step is to create the shared memory se)-.15 E 2.5(gment. This)-.15 F
(is best done after the creation of the XImage,)2.5 E
(since you need to mak)72 318 Q 2.5(eu)-.1 G
(se of the information in that XImage to kno)-2.5 E 2.5(wh)-.25 G .5
-.25(ow m)-2.5 H(uch memory to allocate.).25 E -.8(To)5 G(create the se)
72 330 Q(gment, you need a call lik)-.15 E(e:)-.1 E F1
(shminfo.shmid = shmget \(IPC_PRIVATE,)97 345.6 Q
(image->bytes_per_line * image->height, IPC_CREAT|0777\);)147 357.6 Q F0
(\(assuming that you ha)72 373.2 Q .3 -.15(ve c)-.2 H
(alled your shared memory XImage `).15 E(`image')-.74 E 2.5('\). Y)-.74
F(ou should, of course, follo)-1.1 E 2.5(wt)-.25 G(he)-2.5 E
(Rules and do error checking on all of these system calls.)72 385.2 Q
(Also, be sure to use the bytes_per_line \214eld, not)5 E
(the width you used to create the XImage as the)72 397.2 Q 2.5(ym)-.15 G
(ay well be dif)-2.5 E(ferent.)-.25 E(Note that the shared memory ID re\
turned by the system is stored in the shminfo structure.)72 412.8 Q
(The serv)5 E(er will)-.15 E(need that ID to attach itself to the se)72
424.8 Q(gment.)-.15 E(Also note that, on man)72 440.4 Q 2.5(ys)-.15 G
(ystems for security reasons, the X serv)-2.5 E
(er will only accept to attach to the shared)-.15 E(memory se)72 452.4 Q
(gment if it')-.15 E 2.5(sr)-.55 G(eadable and writeable by `)-2.5 E
(`other')-.74 E('. On systems where the X serv)-.74 E
(er is able to deter)-.15 E(-)-.2 E(mine the uid of the X client o)72
464.4 Q -.15(ve)-.15 G 2.5(ral).15 G
(ocal transport, the shared memory se)-2.5 E
(gment can be readable and write-)-.15 E
(able only by the uid of the client.)72 476.4 Q(Ne)72 492 Q
(xt, attach this shared memory se)-.15 E(gment to your process:)-.15 E
F1(shminfo.shmaddr = image->data = shmat \(shminfo.shmid, 0, 0\);)97
507.6 Q F0(The address returned by shmat should be stored in *both* the\
 XImage structure and the shminfo structure.)72 523.2 Q 1.6 -.8(To \214)
72 538.8 T
(nish \214lling in the shminfo structure, you need to decide ho).8 E 2.5
(wy)-.25 G(ou w)-2.5 E(ant the serv)-.1 E(er to attach to the shared)
-.15 E(memory se)72 550.8 Q(gment, and set the `)-.15 E(`readOnly')-.74
E 2.5<278c>-.74 G(eld as follo)-2.5 E 2.5(ws. Normally)-.25 F 2.5(,y)
-.65 G(ou w)-2.5 E(ould code:)-.1 E F1(shminfo.readOnly = False;)97
566.4 Q F0(If you set it to T)72 582 Q(rue, the serv)-.35 E
(er will not be able to write to this se)-.15 E
(gment, and thus XShmGetImage calls will)-.15 E -.1(fa)72 594 S(il.).1 E
(Finally)72 609.6 Q 2.5(,t)-.65 G(ell the serv)-2.5 E
(er to attach to your shared memory se)-.15 E(gment with:)-.15 E F1
(Status XShmAttach \(display, shminfo\);)97 625.2 Q F0(If all goes well\
, you will get a non-zero status back, and your XImage is ready for use\
.)72 640.8 Q 1.6 -.8(To w)72 656.4 T
(rite a shared memory XImage into an X dra).8 E -.1(wa)-.15 G
(ble, use XShmPutImage:).1 E F1
(Status XShmPutImage \(display, d, gc, image, src_x, src_y,)97 672 Q
(dest_x, dest_y, width, height, send_event\))223 684 Q
(Display *display;)145 696 Q(Drawable d;)145 708 Q(GC gc;)145 720 Q/F2
10/Times-Bold@0 SF(2)285.5 768 Q 0 Cg EP
%%Page: 3 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(MIT Shared Memory Extension)223.98 48 Q/F1 10
/Courier@0 SF(XImage *image;)145 84 Q(int src_x, src_y, dest_x, dest_y;)
145 96 Q(unsigned int width, height;)145 108 Q(bool send_event;)145 120
Q F0(The interf)72 135.6 Q(ace is identical to that of XPutImage, so I \
will spare my \214ngers and not repeat that documentation)-.1 E 2.5
(here. There)72 147.6 R(is one additional parameter)2.5 E 2.5(,h)-.4 G
-.25(ow)-2.5 G -2.15 -.25(ev e).25 H .8 -.4(r, c).25 H(alled `).4 E
(`send_e)-.74 E -.15(ve)-.25 G(nt').15 E 2.5('. If)-.74 F
(this parameter is passed as T)2.5 E(rue,)-.35 E(the serv)72 159.6 Q
(er will generate a `)-.15 E(`completion')-.74 E 2.5('e)-.74 G -.15(ve)
-2.75 G(nt when the image write is complete; thus your program can).15 E
(kno)72 171.6 Q 2.5(ww)-.25 G(hen it is safe to be)-2.5 E
(gin manipulating the shared memory se)-.15 E(gment ag)-.15 E(ain.)-.05
E(The completion e)72 187.2 Q -.15(ve)-.25 G
(nt has type XShmCompletionEv).15 E
(ent, which is de\214ned as the follo)-.15 E(wing:)-.25 E F1
(typedef struct {)97 202.8 Q 2(int type;)121 214.8 R(/* of event */)69 E
(unsigned long serial;)121 226.8 Q(/* # of last request processed */)18
E(Bool send_event;)121 238.8 Q
(/* true if came from a SendEvent request */)29 E(Display *display;)121
250.8 Q(/* Display the event was read from */)48 E(Drawable drawable;)
121 262.8 Q(/* drawable of request */)42 E(int major_code;)121 274.8 Q
(/* ShmReqCode */)35 E(int minor_code;)121 286.8 Q(/* X_ShmPutImage */)
35 E(ShmSeg shmseg;)121 298.8 Q(/* the ShmSeg used in the request */)41
E(unsigned long offset;)121 310.8 Q(/* the offset into ShmSeg used */)18
E 6(}X)97 322.8 S(ShmCompletionEvent;)-6 E F0(The e)72 338.4 Q -.15(ve)
-.25 G(nt type v).15 E(alue that will be used can be determined at run \
time with a line of the form:)-.25 E F1
(int CompletionType = XShmGetEventBase \(display\) + ShmCompletion;)97
354 Q F0(If you modify the shared memory se)72 369.6 Q
(gment before the arri)-.15 E -.25(va)-.25 G 2.5(lo).25 G 2.5(ft)-2.5 G
(he completion e)-2.5 E -.15(ve)-.25 G(nt, the results you see on).15 E
(the screen may be inconsistent.)72 381.6 Q 1.6 -.8(To r)72 397.2 T
(ead image data into a shared memory XImage, use the follo).8 E(wing:)
-.25 E F1(Status XShmGetImage \(display, d, image, x, y, plane_mask\))97
412.8 Q(Display *display;)122 424.8 Q(Drawable d;)122 436.8 Q
(XImage *image;)122 448.8 Q(int x, y;)122 460.8 Q
(unsigned long plane_mask;)122 472.8 Q F0(Where `)72 488.4 Q(`display')
-.74 E 2.5('i)-.74 G 2.5(st)-2.5 G(he display of interest, `)-2.5 E(`d')
-.74 E 2.5('i)-.74 G 2.5(st)-2.5 G(he source dra)-2.5 E -.1(wa)-.15 G
(ble, `).1 E(`image')-.74 E 2.5('i)-.74 G 2.5(st)-2.5 G
(he destination XImage,)-2.5 E -.74(``)72 500.4 S(x').74 E 2.5('a)-.74 G
(nd `)-2.5 E(`y')-.74 E 2.5('a)-.74 G(re the of)-2.5 E(fsets within `)
-.25 E(`d')-.74 E(', and `)-.74 E(`plane_mask')-.74 E 2.5('d)-.74 G
(e\214nes which planes are to be read.)-2.5 E 1.6 -.8(To d)72 516 T
(estro).8 E 2.5(yas)-.1 G
(hared memory XImage, you should \214rst instruct the serv)-2.5 E
(er to detach from it, then destro)-.15 E 2.5(yt)-.1 G(he)-2.5 E(se)72
528 Q(gment itself, as follo)-.15 E(ws:)-.25 E F1
(XShmDetach \(display, shminfo\);)97 543.6 Q(XDestroyImage \(image\);)97
555.6 Q(shmdt \(shminfo.shmaddr\);)97 567.6 Q
(shmctl \(shminfo.shmid, IPC_RMID, 0\);)97 579.6 Q/F2 10/Times-Bold@0 SF
2.5(5. USE)72 603.6 R(OF SHARED MEMOR)2.5 E 2.5(YP)-.35 G(IXMAPS)-2.5 E
F0(Unlik)72 619.2 Q 2.5(eXi)-.1 G(mages, for which an)-2.5 E 2.5(yi)-.15
G(mage format is usable, the shared memory e)-2.5 E
(xtension supports only a sin-)-.15 E(gle format \(i.e. XYPixmap or ZPi\
xmap\) for the data stored in a shared memory pixmap.)72 631.2 Q
(This format is)5 E
(independent of the depth of the image \(for 1-bit pixmaps it doesn')72
643.2 Q 2.5(tr)-.18 G(eally matter what this format is\) and)-2.5 E
(independent of the screen.)72 655.2 Q(Use XShmPixmapF)5 E
(ormat to get the format for the serv)-.15 E(er:)-.15 E F1
(int XShmPixmapFormat \(display\))97 670.8 Q(Display *display;)145 682.8
Q F0(If your application can deal with the serv)72 698.4 Q
(er pixmap data format \(including bits-per)-.15 E(-pix)-.2 E
(el et al.\), create a)-.15 E(shared memory se)72 710.4 Q(gment and `)
-.15 E(`shminfo')-.74 E 2.5('s)-.74 G(tructure in e)-2.5 E
(xactly the same w)-.15 E(ay as is listed abo)-.1 E .3 -.15(ve f)-.15 H
(or shared).15 E(memory XImages.)72 722.4 Q(While it is, not strictly n\
ecessary to create an XImage \214rst, doing so incurs little)5 E F2(3)
285.5 768 Q 0 Cg EP
%%Page: 4 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(MIT Shared Memory Extension)223.98 48 Q -.15
(ove)72 84 S(rhead and will gi).15 E .3 -.15(ve y)-.25 H
(ou an appropriate bytes_per_line v).15 E(alue to use.)-.25 E
(Once you ha)72 99.6 Q .3 -.15(ve y)-.2 H
(our shminfo structure \214lled in, simply call:).15 E/F1 10/Courier@0
SF(Pixmap XShmCreatePixmap \(display, d, data, shminfo, width,)97 115.2
Q(height, depth\);)247 127.2 Q(Display *display;)145 139.2 Q
(Drawable d;)145 151.2 Q(char *data;)145 163.2 Q
(XShmSegmentInfo *shminfo;)145 175.2 Q
(unsigned int width, height, depth;)145 187.2 Q F0(The ar)72 202.8 Q
(guments are all the same as for XCreatePixmap, with tw)-.18 E 2.5(oa)
-.1 G(dditions: `)-2.5 E(`data')-.74 E 2.5('a)-.74 G(nd `)-2.5 E
(`shminfo')-.74 E 2.5('. The)-.74 F(second of the tw)72 214.8 Q 2.5(oi)
-.1 G 2.5(st)-2.5 G
(he same old shminfo structure that has been used before.)-2.5 E
(The \214rst is the pointer to the)5 E(shared memory se)72 226.8 Q
(gment, and should be the same as the shminfo.shmaddr \214eld.)-.15 E
2.5(Ia)5 G 2.5(mn)-2.5 G(ot sure wh)-2.5 E 2.5(yt)-.05 G(his is a)-2.5 E
(separate parameter)72 238.8 Q(.)-.55 E(If e)72 254.4 Q -.15(ve)-.25 G
(rything w).15 E(orks, you will get back a pixmap, which you can manipu\
late in all of the usual w)-.1 E(ays, with)-.1 E(the added bonus of bei\
ng able to tweak its contents directly through the shared memory se)72
266.4 Q 2.5(gment. Shared)-.15 F(memory pixmaps are destro)72 278.4 Q
(yed in the usual manner with XFreePixmap, though you should detach and)
-.1 E(destro)72 290.4 Q 2.5(yt)-.1 G(he shared memory se)-2.5 E
(gment itself as sho)-.15 E(wn abo)-.25 E -.15(ve)-.15 G(.).15 E/F2 10
/Times-Bold@0 SF(4)285.5 768 Q 0 Cg EP
%%Trailer
end
%%EOF
